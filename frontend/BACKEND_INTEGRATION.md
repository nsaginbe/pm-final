# Backend Integration - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å Python FastAPI backend —á–µ—Ä–µ–∑ **Retrofit + Dio**.

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **pubspec.yaml** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   - `retrofit: ^4.0.3`
   - `retrofit_generator: ^8.0.6`

2. **lib/services/dio_config.dart** [–ù–û–í–´–ô]
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Dio HTTP client
   - Base URL: `http://10.0.2.2:8000` (–¥–ª—è Android —ç–º—É–ª—è—Ç–æ—Ä–∞)
   - Timeouts: 30 —Å–µ–∫—É–Ω–¥
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤

3. **lib/services/api_client.dart** [–ù–û–í–´–ô]
   - Retrofit API interface
   - 3 –º–µ—Ç–æ–¥–∞: `runTradingCycle()`, `getTradeHistory()`, `getLatestMarketData()`
   - –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤—ã–∑–æ–≤—ã API

4. **lib/providers/trading_cycle_provider.dart** [–ò–ó–ú–ï–ù–Å–ù]
   - –ó–∞–º–µ–Ω—ë–Ω `MockApiService` –Ω–∞ `ApiClient`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ DioException
   - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

5. **lib/providers/trade_history_provider.dart** [–ò–ó–ú–ï–ù–Å–ù]
   - –ó–∞–º–µ–Ω—ë–Ω `MockApiService` –Ω–∞ `ApiClient`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫

---

## üöÄ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å Backend

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Python FastAPI backend –∑–∞–ø—É—â–µ–Ω:

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é backend
cd backend

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ uvicorn)
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –æ—Ç–≤–µ—á–∞–µ—Ç:
```bash
curl http://localhost:8000/health
# –∏–ª–∏
curl http://localhost:8000/docs
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ù–∞ Android —ç–º—É–ª—è—Ç–æ—Ä–µ:**
```bash
flutter run
```

**–ù–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `lib/services/dio_config.dart`
2. –ò–∑–º–µ–Ω–∏—Ç–µ `baseUrl` –Ω–∞ IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏:
   ```dart
   static const String baseUrl = 'http://192.168.x.x:8000';
   ```
3. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à IP:
   - Mac/Linux: `ifconfig | grep inet`
   - Windows: `ipconfig`

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

1. **Dashboard Screen:**
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª"
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å backend
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ç—Ä—ë—Ö –∞–≥–µ–Ω—Ç–æ–≤

2. **Trade History:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–¥–µ–ª–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å backend

3. **Pull-to-Refresh:**
   - –ü–æ—Ç—è–Ω–∏—Ç–µ —ç–∫—Ä–∞–Ω –≤–Ω–∏–∑ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üîç Debugging

### –õ–æ–≥–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤

–í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –±–ª–∞–≥–æ–¥–∞—Ä—è Logger.

–í Android Studio/VS Code –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
[INFO] ‚Üí POST http://10.0.2.2:8000/trading/run-cycle
[INFO] ‚Üê 200 OK (1234ms)
[INFO] Response: {"cycle_id": 1, ...}
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

**1. "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω
- –î–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `http://10.0.2.2:8000`
- –î–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ - IP –∞–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

**2. "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è"**
- Backend –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ `dio_config.dart` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

**3. CORS –æ—à–∏–±–∫–∏**
- Backend –¥–æ–ª–∂–µ–Ω —Ä–∞–∑—Ä–µ—à–∏—Ç—å CORS –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –≤ FastAPI

---

## üì± –ê–¥—Ä–µ—Å–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

| –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ | Base URL |
|------------|----------|
| Android Emulator | `http://10.0.2.2:8000` |
| iOS Simulator | `http://localhost:8000` –∏–ª–∏ `http://127.0.0.1:8000` |
| –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ | `http://192.168.x.x:8000` (IP –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞) |

---

## üîÑ –û—Ç–∫–∞—Ç –∫ Mock –¥–∞–Ω–Ω—ã–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ mock –¥–∞–Ω–Ω—ã–º:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `lib/providers/trading_cycle_provider.dart`
2. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π provider:
   ```dart
   // final apiClientProvider = Provider<ApiClient>((ref) {
   //   final dio = DioConfig.createDio();
   //   return ApiClient(dio);
   // });
   ```
3. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ä—ã–π:
   ```dart
   final mockApiServiceProvider = Provider<MockApiService>((ref) {
     return MockApiService();
   });
   ```
4. –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä notifier –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ MockApiService

**–ò–ª–∏ –ø—Ä–æ—â–µ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `/lib/services/mock_api_service.dart`

---

## ‚ú® –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å backend, –º–æ–∂–Ω–æ:

1. **–î–æ–±–∞–≤–∏—Ç—å BLoC** - –∑–∞–º–µ–Ω–∏—Ç—å Riverpod –Ω–∞ flutter_bloc
2. **–£–ª—É—á—à–∏—Ç—å error handling** - –¥–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É
3. **–î–æ–±–∞–≤–∏—Ç—å offline mode** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
4. **–î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API URL** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω—è—Ç—å URL –≤ Settings

---

## üìä API Endpoints

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ endpoints:

### 1. POST /trading/run-cycle
```
Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: symbol=BTCUSDT
Response: TradingCycleResponse
```

### 2. GET /trades
```
Response: List<Trade>
```

### 3. GET /market/latest
```
Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: symbol=BTCUSDT
Response: MarketData
```

---

## üéØ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
lib/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ api_client.dart          ‚Üê Retrofit API client
‚îÇ   ‚îú‚îÄ‚îÄ api_client.g.dart        ‚Üê Generated code
‚îÇ   ‚îú‚îÄ‚îÄ dio_config.dart          ‚Üê Dio configuration
‚îÇ   ‚îî‚îÄ‚îÄ mock_api_service.dart    ‚Üê –°–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ trading_cycle_provider.dart   ‚Üê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ApiClient
‚îÇ   ‚îî‚îÄ‚îÄ trade_history_provider.dart   ‚Üê –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ApiClient
‚îÇ
‚îî‚îÄ‚îÄ ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º backend —á–µ—Ä–µ–∑ Retrofit. –í—Å–µ UI —ç–∫—Ä–∞–Ω—ã –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
